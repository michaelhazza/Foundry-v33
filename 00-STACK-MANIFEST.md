# Stack Manifest v1.0

**Purpose:** Single source of truth for specification stack composition  
**Enforcement:** Gate #53 validates manifest completeness before code generation  
**Rule:** Ignore any file not listed in this manifest

---

## CANONICAL SPEC FILES

### Core Framework (2 files)

| File | Canonical Reference | Purpose | Required |
|------|-------------------|---------|----------|
| `00-STACK-MANIFEST.md` | Stack Manifest | Stack composition & validation rules | YES |
| `agent-0-constitution-v4.5.md` | Agent 0 / Constitution | Framework-wide rules & principles | YES |

### Agent Specifications (8 files)

| File | Canonical Reference | Purpose | Required |
|------|-------------------|---------|----------|
| `agent-1-product-definition-v19.md` | Agent 1 | Product requirements & user stories | YES |
| `agent-2-system-architecture-v25.md` | Agent 2 | Architecture decisions & constraints | YES |
| `agent-3-data-modeling-v22.md` | Agent 3 | Database schema & relationships | YES |
| `agent-4-api-contract-v36.md` | Agent 4 | API contracts & service definitions | YES |
| `agent-5-ui-specification-v33.md` | Agent 5 | UI/UX requirements & page inventory | YES |
| `agent-6-implementation-orchestrator-v50.md` | Agent 6 | Implementation patterns & templates | YES |
| `agent-7-qa-deployment-v46.md` | Agent 7 | Verification gates & deployment config | YES |
| `agent-8-code-review-v41.md` | Agent 8 | Quality audit patterns & auto-fix rules | YES |

### Build Instructions (1 file)

| File | Canonical Reference | Purpose | Required |
|------|-------------------|---------|----------|
| `claude-code-master-build-prompt.md` | Claude Code Master Build Prompt (current) / Build Prompt (current) | Execution orchestration & phase workflow | YES |

### Supporting Documentation (1 file)

| File | Canonical Reference | Purpose | Required |
|------|-------------------|---------|----------|
| `replit-environment-setup-ai-optimized.md` | Replit Setup Guide | Environment configuration templates | NO |

**Total Required Files:** 11  
**Total Optional Files:** 1 (Replit Setup)

---

## MACHINE-READABLE CONTRACTS

### Contract Files Generated During Build

These files are **created by agents** during spec generation and **consumed by Agent 6** for validation:

| File | Generated By | Consumed By | Purpose |
|------|-------------|-------------|---------|
| `service-contracts.json` | Agent 4 | Agent 6 | Service method signatures & validation rules |
| `routes-pages-manifest.json` | Agent 5 | Agent 6 | Route-to-page mappings & data dependencies |
| `architectural-decisions.json` | Agent 2 | Agent 6, Gate #53 | Explicit technology/pattern choices |

**Location:** These files are created in `/docs` during Phase 0 and validated in Phase 1.

---

## CANONICAL REFERENCE NAMES

### Non-Versioned References (REQUIRED)

When referencing specs in agent outputs or verification scripts, use these **exact strings**:

| Spec | Canonical Reference (Use This) | Disallowed (Never Use) |
|------|-------------------------------|------------------------|
| Constitution | `Agent 0` / `Constitution` / `Inherited from Agent 0` | `Agent 0 v4.5`, `Constitution v4.x` |
| Product Definition | `Agent 1` | `Agent 1 v19` |
| System Architecture | `Agent 2` | `Agent 2 v24` |
| Data Modeling | `Agent 3` | `Agent 3 v22` |
| API Contract | `Agent 4` | `Agent 4 v35.1`, `Agent 4 v35` |
| UI Specification | `Agent 5` | `Agent 5 v32` |
| Implementation Orchestrator | `Agent 6` | `Agent 6 v49` |
| QA & Deployment | `Agent 7` | `Agent 7 v45` |
| Code Review | `Agent 8` | `Agent 8 v41` |
| Build Prompt | `Claude Code Master Build Prompt (current)` / `Build Prompt (current)` | `Build Prompt v20`, `Build Prompt v19` |

**Enforcement:** Gate #53 fails if versioned references (e.g., "Agent 4 v35.1") are found outside VERSION HISTORY sections.

---

## VALIDATION RULES

### Manifest Completeness (Gate #53 Phase 0.0)

Gate #53 validates the following **before any code generation**:

#### 1. File Presence Check
```bash
REQUIRED_FILES=(
  "00-STACK-MANIFEST.md"
  "agent-0-constitution-v4.5.md"
  "agent-1-product-definition-v19.md"
  "agent-2-system-architecture-v25.md"
  "agent-3-data-modeling-v22.md"
  "agent-4-api-contract-v36.md"
  "agent-5-ui-specification-v33.md"
  "agent-6-implementation-orchestrator-v50.md"
  "agent-7-qa-deployment-v46.md"
  "agent-8-code-review-v41.md"
  "claude-code-master-build-prompt.md"
)

for file in "${REQUIRED_FILES[@]}"; do
  [ -f "$file" ] || { echo "[X] FAIL - Missing required file: $file"; exit 1; }
done
```

#### 2. No Extra Specs Check
```bash
# Fail if specs directory contains files not in manifest
ALLOWED_PATTERN="^(00-STACK-MANIFEST|agent-[0-8]-|claude-code-master-build-prompt|replit-environment-setup)"
find . -maxdepth 1 -name "*.md" | while read file; do
  basename "$file" | grep -E "$ALLOWED_PATTERN" || {
    echo "[X] FAIL - Unexpected spec file: $file (not in manifest)"
    exit 1
  }
done
```

#### 3. Canonical Reference Check
```bash
# Fail if versioned cross-references found (except in VERSION HISTORY)
grep -rn "Agent [0-8] v[0-9]" agent-*.md | grep -v "VERSION HISTORY" | grep -v "What Changed" && {
  echo "[X] FAIL - Versioned agent reference found (use canonical names)"
  exit 1
}

grep -rn "Build Prompt v[0-9]" agent-*.md | grep -v "VERSION HISTORY" | grep -v "What Changed" && {
  echo "[X] FAIL - Versioned Build Prompt reference found (use 'Build Prompt (current)')"
  exit 1
}
```

#### 4. ASCII-Only Encoding Check
```bash
# Fail if non-ASCII bytes detected
for file in *.md; do
  if LC_ALL=C grep -qP '[^\x00-\x7F]' "$file"; then
    echo "[X] FAIL - Non-ASCII characters in $file"
    exit 1
  fi
done
```

#### 5. Contract Files Present (After Agent 4/5 Generation)
```bash
# After Agent 4 runs
[ -f "docs/service-contracts.json" ] || {
  echo "[X] FAIL - Agent 4 must generate service-contracts.json"
  exit 1
}

# After Agent 5 runs
[ -f "docs/routes-pages-manifest.json" ] || {
  echo "[X] FAIL - Agent 5 must generate routes-pages-manifest.json"
  exit 1
}

# After Agent 2 runs
[ -f "docs/architectural-decisions.json" ] || {
  echo "[X] FAIL - Agent 2 must generate architectural-decisions.json"
  exit 1
}
```

---

## FILE EVOLUTION POLICY

### When Updating Spec Files

**Allowed:**
- Update file content (rules, patterns, examples)
- Change version in filename (e.g., `agent-7-v45.md` → `agent-7-v46.md`)
- Add entries to VERSION HISTORY tables

**Required:**
- Update manifest if filename changes
- Maintain canonical reference name (do not add version to cross-references)
- Keep VERSION HISTORY as historical record only

**Example - Agent 7 Update v45 → v46:**
```bash
# 1. Rename file
mv agent-7-qa-deployment-v46.md agent-7-qa-deployment-v46.md

# 2. Update manifest
sed -i 's/agent-7-qa-deployment-v46.md/agent-7-qa-deployment-v46.md/g' 00-STACK-MANIFEST.md

# 3. Cross-references DO NOT change (still "Agent 7" everywhere)
# No edits needed in other agent files!
```

---

### When Updating Build Prompt

**Allowed:**
- Update content, add features, change workflow
- Add entry to VERSION HISTORY table

**Not Allowed:**
- Adding version number to title (keep "Claude Code Master Build Prompt")
- Adding version number to footer (keep "Claude Code Master Build Prompt Complete")
- Adding version number to operational text

**Cross-references remain:** `Claude Code Master Build Prompt (current)` in all agents

---

## IGNORE POLICY

### Strict Exclusion Rule

Claude Code and all agents **MUST IGNORE** any files not listed in this manifest, including:

❌ `agent-1-v18.md` (old version not in manifest)  
❌ `build-prompt-v19.md` (old version not in manifest)  
❌ `README.md` (not a spec file)  
❌ `notes.txt` (not a spec file)  
❌ `draft-agent-9.md` (not in manifest)  

**Only read files explicitly listed in the "CANONICAL SPEC FILES" table.**

---

## VERIFICATION CHECKLIST

Before starting code generation, Gate #53 validates:

- [x] All 11 required files present
- [x] No extra .md files in specs directory (except allowed)
- [x] All files ASCII-encoded (no mojibache)
- [x] No versioned cross-references (except in VERSION HISTORY)
- [x] Constitution inheritance format used ("Inherited from Agent 0")
- [x] Build Prompt canonical reference declared
- [x] After Agent 2/4/5 run: Machine-readable contracts present

**If any check fails:** BLOCK code generation, fix specs first.

---

## MANIFEST VERSION HISTORY

| Version | Date | Changes |
|---------|------|---------|
| v1.0 | 2026-01-28 | Initial manifest. Established canonical file list, reference names, validation rules. Added machine-readable contract requirements. Defined strict ignore policy. Integrated with Gate #53 validation. |

---

## DOCUMENT END

**Stack Manifest v1.0 Complete**
